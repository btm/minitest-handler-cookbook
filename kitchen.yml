<%
  provisioner = ENV['KITCHEN_PROVISIONER'] || 'chef_zero'
  omnibus_version = ENV['KITCHEN_OMNIBUS_VER'] || 'true'
  driver = ENV['KITCHEN_DRIVER'] || 'vagrant'
%>

---
driver:
  name: <%= driver %>

<% if driver == 'digitalocean' %>
driver_config:
  digitalocean_client_id: <%= ENV['DIGITALOCEAN_CLIENT_ID'] %>
  digitalocean_api_key: <%= ENV['DIGITALOCEAN_API_KEY'] %>
  region_id: <%= ENV['DIGITALOCEAN_REGION_ID'] || '1' %>
  ssh_key_ids: <%= ENV['DIGITALOCEAN_SSH_KEY_IDS'] %>
  ssh_key: <%= ENV['DIGITALOCEAN_SSH_KEY'] %>
  flavor_id: 66
<% end %>

provisioner:
  name: <%= provisioner %>
  require_chef_omnibus: <%= omnibus_version %>

platforms:
- name: ubuntu-20.04
  driver_config:
  <% if driver == 'vagrant' %>
    box: bento/ubuntu-20.04
  <% elsif driver == 'digitalocean' %>
    image: ubuntu-20
  <% elsif driver == 'docker' %>
    image: ubuntu:20.04
  <% end %>


- name: centos-8
  driver_config:
  <% if driver == 'vagrant' %>
    box: bento/centos-8
  <% elsif driver == 'digitalocean' %>
    image: centos-8
  <% elsif driver == 'docker' %>
    image: centos:8
  <% end %>

suites:
- name: default
  run_list:
    - recipe[minitest-handler]
    - recipe[minitest-handler_test1]
    - recipe[minitest-handler_test1::not_default]
    - recipe[minitest-handler_test1::wrong_dir]
    - recipe[minitest-handler_test1::gh67]
    - recipe[minitest-handler_test1::gh93]

- name: legacy_paths
  run_list:
    - recipe[minitest-handler]
    - recipe[minitest-handler_test2::legacy_paths]
  attributes:
    minitest:
      recipes: [ "minitest-handler_test2::legacy_paths" ]

- name: include_recipe
  run_list:
    - recipe[minitest-handler]
    - recipe[minitest-handler_test2]

# This suite is used to excercise that when a filter
# is set it used properly
- name: filter_applied
  run_list:
    - recipe[minitest-handler]
    - recipe[minitest-handler_test1]
    - recipe[minitest-handler_test2]
  attributes:
    minitest:
      filter: /minitest-handler_test1/
